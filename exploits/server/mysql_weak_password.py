#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author: Lcy
# @Date:   2016-09-26 08:56:24
# @Last Modified by:   Lcy
# @Last Modified time: 2016-09-26 10:23:20
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author: Lcy
# @Date:   2016-09-20 15:34:41
# @Last Modified by:   Lcy
# @Last Modified time: 2016-09-23 16:57:28
import socket
from lib.util import url2ip
class Exploit:
    def __init__(self,target,expfile):
        self.target = target
        self.result = {
            "name": "MySQL弱口令",
            "author": "Lcy",
            "type": "server",
            "ref": "https://phpinfo.me",
            "status":False,
            "info":"",
            'filename':expfile,
            "target":target,
        }
    def crack(self,ip,password):
        try:
            conn=MySQLdb.connect(host=ip,user='root',passwd=password,db='mysql',port=3306,connect_timeout=4)
            return 200
        except Exception,e:
            return e[0]
    def verify(self):
        s = socket.socket()
        socket.setdefaulttimeout(5)
        try:
            host = self.target
            port = 3306
            s.connect((host, port))
            s.close()
            pwd = ["","123456","root","a123456","5201314","111111"]
            for p in pwd:
                errCode = self.crack(self,host,p)
                if errCode == 200:
                    self.result['status'] = True
                    self.result['info'] = '%s目标存在MySQL弱口令 ,用户名为root,密码为%s' % (self.target,p)
                    break
                elif errCode == 1045:
                    continue
                else:
                    break
        except Exception,e:
            pass
       